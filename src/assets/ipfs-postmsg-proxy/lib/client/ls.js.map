{"version":3,"sources":["../../src/client/ls.js"],"names":["opts","api","ls","variadic","lsReadableStream","source","lsPullStream","arguments","res","name","deferred","then","resolve","catch","err","abort"],"mappings":";;;;;;kBASe,UAAUA,IAAV,EAAgB;AAC7B,MAAMC,MAAM;AACVC,QAAI,sBAAYC,QAAZ,CACF,kBACE,6BAAgB,CAAhB,CADF,EAEE,uBAAa,CAAb,CAFF,EAGE,wBAAO,SAAP,EAAkBH,IAAlB,CAHF,CADE,CADM;AAQVI,oBARU,8BAQU;AAClB,aAAO,6BAASC,MAAT,CAAgBJ,IAAIK,YAAJ,YAAoBC,SAApB,CAAhB,CAAP;AACD,KAVS;;AAWVD,kBAAe,YAAM;AACnB,UAAMA,eAAe,kBACnB,6BAAgB,CAAhB,CADmB,EAEnB,uBAAa,CAAb,CAFmB,EAGnB,mBACE,wBAAO,mBAAP,EAA4BN,IAA5B,CADF,EAEE,UAACQ,GAAD;AAAA,eAAS,4BAAIH,MAAJ,CAAWG,IAAIC,IAAf,EAAqBT,IAArB,CAAT;AAAA,OAFF,CAHmB,CAArB;;AASA,aAAO,YAAa;AAClB,YAAMU,WAAW,oBAAML,MAAN,EAAjB;;AAEAC,iDACGK,IADH,CACQ,UAACH,GAAD;AAAA,iBAASE,SAASE,OAAT,CAAiBJ,GAAjB,CAAT;AAAA,SADR,EAEGK,KAFH,CAES,UAACC,GAAD;AAAA,iBAASJ,SAASK,KAAT,CAAeD,GAAf,CAAT;AAAA,SAFT;;AAIA,eAAOJ,QAAP;AACD,OARD;AASD,KAnBa;AAXJ,GAAZ;;AAiCA,SAAOT,GAAP;AACD,C;;AA5CD;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;AACA;;AACA","file":"ls.js","sourcesContent":["import { caller } from 'postmsg-rpc'\nimport callbackify from 'callbackify'\nimport defer from 'pull-defer'\nimport toStream from 'pull-stream-to-stream'\nimport PMS from 'pull-postmsg-stream'\nimport { pre, post } from 'prepost'\nimport { preCidToJson } from '../serialization/cid'\nimport { preBufferToJson } from '../serialization/buffer'\n\nexport default function (opts) {\n  const api = {\n    ls: callbackify.variadic(\n      pre(\n        preBufferToJson(0),\n        preCidToJson(0),\n        caller('ipfs.ls', opts)\n      )\n    ),\n    lsReadableStream () {\n      return toStream.source(api.lsPullStream(...arguments))\n    },\n    lsPullStream: (() => {\n      const lsPullStream = pre(\n        preBufferToJson(0),\n        preCidToJson(0),\n        post(\n          caller('ipfs.lsPullStream', opts),\n          (res) => PMS.source(res.name, opts)\n        )\n      )\n\n      return (...args) => {\n        const deferred = defer.source()\n\n        lsPullStream(...args)\n          .then((res) => deferred.resolve(res))\n          .catch((err) => deferred.abort(err))\n\n        return deferred\n      }\n    })()\n  }\n\n  return api\n}\n"]}